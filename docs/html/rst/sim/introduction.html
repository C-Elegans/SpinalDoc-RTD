

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction &mdash; SpinalHDL 1.11 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> SpinalHDL
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SpinalHDL</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Introduction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/rst/sim/introduction.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>As always you can use your standard simulation tools to simulate the VHDL/Verilog generated out from SpinalHDL, but since SpinalHDL 1.0.0 the language integrate an API to write testbenches and test your hardware directly in Scala. This API provide the capabilities to read and write the DUT signals, fork and join simulation processes, sleep and wait until a given condition is filled.</p>
</div>
<div class="section" id="how-spinalhdl-simulate-the-hardware">
<h1>How SpinalHDL simulate the hardware<a class="headerlink" href="#how-spinalhdl-simulate-the-hardware" title="Permalink to this headline">¶</a></h1>
<p>Behind the scene SpinalHDL is generating a C++ cycle accurate model of your hardware by generating the equivalent Verilog and asking Verilator to convert it into a C++ model. <span class="raw-html-m2r"><br></span>
Then SpinalHDL ask GCC to compile the C++ model into an shared object (.so) and bind it back to Scala via JNR-FFI. <span class="raw-html-m2r"><br></span>
Finaly, as the native Verilator API is rude, SpinalHDL abstract it by providing an simulation multi-threaded API to help the user in his testbench implementation.</p>
<p>This method has several advantage :</p>
<ul class="simple">
<li>The C++ simulation model is realy fast to process simulation steps</li>
<li>It test the generated Verilog hardware instead of the SpinalHDL internal model</li>
<li>It doesn’t require SpinalHDL to be able itself to simulate the hardware (Less codebase, less bugs as Verilator is a reliable tool)</li>
</ul>
<p>And some limitations :</p>
<ul class="simple">
<li>Verilator will only accept to translate Synthetisable Verilog code</li>
</ul>
</div>
<div class="section" id="performance">
<h1>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h1>
<p>As verilator is currently the simulation backend, the simulation speed is realy high. On a little SoC like <a class="reference external" href="https://github.com/SpinalHDL/VexRiscv#murax-soc">Murax</a> my laptop is capable to simulate 1.2 million clock cycles per realtime seconds.</p>
</div>
<div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<p>The SpinalSim with Verilator as backend is supported on both Linux and Windows platforms.</p>
<div class="section" id="scala">
<h2>Scala<a class="headerlink" href="#scala" title="Permalink to this headline">¶</a></h2>
<p>Don’t forget to add the following in your build.sbt file</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">scalaVersion</span> <span class="o">:=</span> <span class="s">&quot;2.11.6&quot;</span>
<span class="n">addCompilerPlugin</span><span class="o">(</span><span class="s">&quot;org.scala-lang.plugins&quot;</span> <span class="o">%</span> <span class="s">&quot;scala-continuations-plugin_2.11.6&quot;</span> <span class="o">%</span> <span class="s">&quot;1.0.2&quot;</span><span class="o">)</span>
<span class="n">scalacOptions</span> <span class="o">+=</span> <span class="s">&quot;-P:continuations:enable&quot;</span>
<span class="n">fork</span> <span class="o">:=</span> <span class="kc">true</span>
</pre></div>
</div>
<p>And you will always need the following imports in your Scala testbench :</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">spinal.sim._</span>
<span class="k">import</span> <span class="nn">spinal.core._</span>
<span class="k">import</span> <span class="nn">spinal.core.sim._</span>
</pre></div>
</div>
</div>
<div class="section" id="linux">
<h2>Linux<a class="headerlink" href="#linux" title="Permalink to this headline">¶</a></h2>
<p>You will also need a recent version of Verilator installed :</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo apt-get install git make autoconf g++ flex bison -y  <span class="c1"># First time prerequisites</span>
git clone http://git.veripool.org/git/verilator   <span class="c1"># Only first time</span>
unsetenv VERILATOR_ROOT  <span class="c1"># For csh; ignore error if on bash</span>
<span class="nb">unset</span> VERILATOR_ROOT  <span class="c1"># For bash</span>
<span class="nb">cd</span> verilator
git pull        <span class="c1"># Make sure we&#39;re up-to-date</span>
git checkout verilator_3_916
autoconf        <span class="c1"># Create ./configure script</span>
./configure
make -j<span class="k">$(</span>nproc<span class="k">)</span>
sudo make install
<span class="nb">echo</span> <span class="s2">&quot;DONE&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="windows">
<h2>Windows<a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h2>
<p>In order to get SpinalSim + Verilator working on windows, you have to do the following :</p>
<ul class="simple">
<li>Install MSYS2</li>
<li>Via MSYS2 get gcc/g++/verilator (for verilator you can compile it from the sources)</li>
<li>Add bin and usrbin of MSYS2 into your windows PATH (ie : C:msys64usrbin;C:msys64mingw64bin)</li>
</ul>
<p>Then you should be able to run SpinalSim + verilator from your Scala project without having to use MSYS2 anymore.</p>
<p>From a fresh install of MSYS2 MinGW 64-bits, you will have to run the following commands inside the MSYS2 MinGW 64-bits shell (enter commands one by one):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pacman -Syuu
<span class="c1">#Close the MSYS2 shell once you&#39;re asked to</span>
pacman -Syuu
pacman -S --needed base-devel mingw-w64-x86_64-toolchain <span class="se">\</span>
                   git flex<span class="se">\</span>
                   mingw-w64-x86_64-cmake

git clone http://git.veripool.org/git/verilator
<span class="nb">unset</span> VERILATOR_ROOT
<span class="nb">cd</span> verilator
git pull
git checkout verilator_3_916
autoconf
./configure
<span class="nb">export</span> <span class="nv">CPLUS_INCLUDE_PATH</span><span class="o">=</span>/usr/include:<span class="nv">$CPLUS_INCLUDE_PATH</span>
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>/usr/bin/core_perl:<span class="nv">$PATH</span>
cp /usr/include/FlexLexer.h ./src

make -j<span class="k">$(</span>nproc<span class="k">)</span>
make install
<span class="nb">echo</span> <span class="s2">&quot;DONE&quot;</span>
<span class="c1">#Add C:\msys64\usr\bin;C:\msys64\mingw64\bin to you windows PATH</span>
</pre></div>
</div>
<p>{% include important.html content=”Be sure that your PATH environnement variable is pointing to the JDK 1.8 and don’t contain a JRE installation.” %}</p>
<p>{% include important.html content=”Adding the MSYS2 bin folders into your windows PATH could potentialy have some side effects. It’s why it is safer to add them as last elements of the PATH to reduce their priority.” %}</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, penis

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>